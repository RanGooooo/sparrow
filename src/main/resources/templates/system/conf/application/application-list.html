<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>系统日志</title>
    <link rel="stylesheet" href="/static/common/open-source/element-ui/element-ui-min.css">
    <link rel="stylesheet" href="/static/common/open-source/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/static/common/common.css">
    <link rel="stylesheet" href="/static/common/component/RanGoDialog.css">
    <script src="/static/common/open-source/jquery/jquery.min.js"></script>
    <script src="/static/common/open-source/element-ui/vue.js"></script>
    <script src="/static/common/open-source/element-ui/element-ui.js"></script>
    <script src="/static/common/common.js"></script>
    <script src="/static/common/component/RanGoDialog.js"></script>
    <style>
        .header-title{
            cursor: pointer;
        }
        .header-icon{
            background-color: #EEEEEE;
            border-radius: 4px;
            text-align: right;
            padding: 0 5px;
            font-size: 18px;
            margin-top: 5px;
        }
        .header-icon i{
            transition: color .15s linear;
        }

        .header-icon i:hover{
            color: #5cb6ff;
        }

    </style>
</head>
<body>

<div id="app">
    <el-table
            :data="tableData"
            style="width: 100%"
            row-key="id"
            lazy
            :load="load"
            :tree-props="{children: 'children', hasChildren: 'position'}">
        <el-table-column
                prop="applicationName"
                label="应用名称"
                width="200">
            <template slot="header" slot-scope="scope">
                <span class="header-title" v-if="applicationNameHeader==='00'" @click="applicationNameHeaderViewClick('01')">应用名称 <i class="el-icon-thumb"></i></span>
                <div v-if="applicationNameHeader==='01'">
                    <div>
                        <el-input v-model="applicationName" size="small"  placeholder="输入应用名称"/>
                    </div>
                    <div class="header-icon">
                        <i class="el-icon-check" @click="applicationNameHeaderSearchClick()"></i>
                        <i class="el-icon-close" @click="applicationNameHeaderViewClick('00')"></i>
                    </div>
                </div>
            </template>
        </el-table-column>
        <el-table-column
                prop="applicationUrl"
                label="应用地址"
                width="380">
        </el-table-column>
        <el-table-column
                prop="applicationIcon"
                label="应用图标"
                width="80"
                align="center">
            <template slot-scope="scope">
                <span v-html = 'scope.row.applicationIcon'></span>
            </template>
        </el-table-column>
        <el-table-column label="禁止使用/正常使用" prop="runningState" align="center">
            <template slot-scope="scope">
                <el-switch
                        v-model="scope.row.runningState"
                        active-color="#00CC66"
                        inactive-color="#888888"
                        active-value="01"
                        inactive-value="00">
                </el-switch>
            </template>
        </el-table-column>
        <el-table-column label="操作">
            <template slot="header" slot-scope="scope">
                <el-button-group>
                    <el-button type="primary" size="small" @click="forwordTSApplicationSave('')">新增菜单</el-button>
                </el-button-group>
            </template>
            <template slot-scope="scope">
                <el-button
                        size="small"
                        @click="forwordTSApplicationSave(scope.row.id)">编辑</el-button>
                <el-button
                        size="small"
                        type="danger"
                        @click="handleDelete(scope.$index, scope.row)">删除</el-button>
            </template>
        </el-table-column>
    </el-table>

</div>
<script>
    new Vue({
        el: "#app",
        data: {
            applicationName: "",
            applicationNameHeader:"00",
            tableData: [],
        },
        mounted() {
            this.tableData = this.searchTSApplicationList('TOP');
        },
        methods: {
            forwordTSApplicationSave: function (id) {
                RanGoDialog.init({
                    title:'新增应用',
                    src: '/TSApplicationController/forwordTSApplicationSave?id=' + id,
                    button: [
                        {
                            name:'确定',
                            click: applicationSave
                        }
                    ]
                });
            },
            searchTSApplicationList(parentApplicationId){
                const self = this;
                let applicationList = [];
                common.ajax({
                    url:"/TSApplicationController/searchTSApplicationList",
                    async:false,
                    data : {
                        "parentApplicationId":parentApplicationId,
                        "applicationName":self.applicationName,
                    },
                    success:function(result){
                        applicationList = result.object;
                    }
                });
                return applicationList;
            },
            load(row, treeNode, resolve) {
                setTimeout(() => {
                    resolve(this.searchTSApplicationList(row.id))
                }, 1000)
            },
            applicationNameHeaderViewClick(status) {
                this.applicationName = '';
                this.applicationNameHeader = status;
            },
            applicationNameHeaderSearchClick() {
                this.tableData = this.searchTSApplicationList('');
            }
        }
    });

    function applicationSave(window) {
        window.app.applicationSave();
    }

</script>
</body>
</html>