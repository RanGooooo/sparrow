<!DOCTYPE html>
<html lang="en">
<head>
    <title>应用管理</title>
    <common-resource th:replace="common/common-resource :: common-resource"></common-resource>
    <style>
        .demo-form-inline {
            padding: 10px 10px 0 10px;
            width: auto;
        }
        .el-form-item{
            margin-bottom: 0!important;
        }
    </style>
</head>
<body>
<div id="app">
    <el-collapse-transition>
        <div v-show="showHeader">
            <el-form :inline="true" :model="dataTableForm" ref="dataTableForm" class="demo-form-inline" size="small">
                <el-form-item label="应用名称" prop="applicationName">
                    <el-input v-model="dataTableForm.applicationName"></el-input>
                </el-form-item>
                <el-form-item label="应用状态" prop="runningState">
                    <el-select v-model="dataTableForm.runningState" clearable>
                        <el-option label="正常使用" value="01"></el-option>
                        <el-option label="禁止使用" value="00"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item>
                    <el-button size="small" @click="dataTableSearch()" type="primary">查询</el-button>
                    <el-button size="small" @click="dataTableReset()">重置</el-button>
                </el-form-item>
            </el-form>
        </div>
    </el-collapse-transition>
    <el-table
            :data="dataTableList"
            row-key="id"
            lazy
            :load="load"
            :tree-props="{children: 'children', hasChildren: 'position'}">
        <el-table-column
                prop="applicationName"
                label="应用名称"
                width="200">
        </el-table-column>
        <el-table-column
                prop="applicationUrl"
                label="应用地址"
                width="380">
        </el-table-column>
        <el-table-column
                prop="applicationIcon"
                label="应用图标"
                width="80"
                align="center">
            <template slot-scope="scope">
                <span v-html = 'scope.row.applicationIcon'></span>
            </template>
        </el-table-column>
        <el-table-column label="禁止使用/正常使用" prop="runningState" align="center">
            <template slot-scope="scope">
                <el-switch
                        v-model="scope.row.runningState"
                        active-color="#00CC66"
                        inactive-color="#888888"
                        active-value="01"
                        inactive-value="00">
                </el-switch>
            </template>
        </el-table-column>
        <el-table-column label="操作">
            <template slot="header">
                <el-button size="small" @click="showHeader = !showHeader">高级筛选</el-button>
                <el-button size="small" @click="forwordTSApplicationSave('')">新增菜单</el-button>
            </template>
            <template slot-scope="scope">
                <el-button
                        size="small"
                        @click="forwordTSApplicationSave(scope.row.id)">编辑</el-button>
                <el-button
                        size="small"
                        type="danger"
                        @click="handleDelete(scope.$index, scope.row)">删除</el-button>
            </template>
        </el-table-column>
    </el-table>

</div>
<script>
    new Vue({
        el: "#app",
        data: {
            dataTableList: [],
            dataTableForm: {
                applicationName:"",
                applicationUrl:"",
                applicationLevel:"",
                applicationOrder:"",
                applicationIcon:"",
                parentApplicationId:"",
                parentApplicationName:"",
                position:"",
                runningState:""
            },
            showHeader: true,

        },
        mounted() {
            this.dataTableList = this.searchTSApplicationList();
        },
        methods: {
            dataTableSearch(){
                if(this.dataTableList.length > 0){
                    this.dataTableList = [];
                }else{
                    this.dataTableForm.parentApplicationId = "";
                    this.dataTableList = this.searchTSApplicationList();
                }
            },
            dataTableReset() {
                this.$refs['dataTableForm'].resetFields();
                this.dataTableList = this.searchTSApplicationList();
            },
            searchTSApplicationList(){
                const self = this;
                let applicationList = [];
                common.ajax({
                    url:"/TSApplicationController/searchTSApplicationList",
                    async:false,
                    data : self.dataTableForm,
                    success:function(result){
                        applicationList = result.object;
                    }
                });
                return applicationList;
            },
            load(row, treeNode, resolve) {
                setTimeout(() => {
                    this.dataTableForm.parentApplicationId = row.id;
                    let resolveList = this.searchTSApplicationList();
                    resolveList.forEach((obj, index) => {
                        this.dataTableList = this.dataTableList.filter(dataTable => dataTable.id !== obj.id);
                    });
                    resolve(resolveList)
                }, 1000)
            },
            forwordTSApplicationSave: function (id) {
                RanGoDialog.init({
                    title:"新增应用",
                    src: '/TSApplicationController/forwordTSApplicationSave?id=' + id,
                    button: [
                        {
                            name:"确定",
                            click: applicationSave
                        }
                    ]
                });
            },
        }
    });

    function applicationSave(window) {
        window.app.applicationSave();
    }

</script>
</body>
</html>